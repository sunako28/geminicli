# .github/workflows/ga4-simple-analysis.yml
name: GA4 Simple Analysis

on:
  workflow_dispatch:
    inputs:
      date_range:
        description: 'åˆ†ææœŸé–“'
        required: false
        default: 'yesterday'
        type: choice
        options:
        - 'yesterday'
        - '7daysAgo'
        - '30daysAgo'
  schedule:
    # æ¯æ—¥åˆå‰10æ™‚ï¼ˆJSTï¼‰ã«å®Ÿè¡Œ
    - cron: '0 1 * * *'
  issue_comment:
    types: [created]

jobs:
  ga4-simple-analysis:
    if: |
      github.event_name == 'workflow_dispatch' ||
      github.event_name == 'schedule' ||
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@gemini analyze'))
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Setup Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: Install MCP Dependencies
        run: |
          npm install @modelcontextprotocol/sdk
          
      - name: Gemini CLI Simple GA4 Analysis
        uses: google-gemini/gemini-cli-action@main
        env:
          GH_TOKEN: ${{ github.token }}
        with:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          settings_json: |
            {
              "mcps": [
                {
                  "name": "google-analytics",
                  "command": "npx",
                  "args": ["@google-analytics/mcp-server"],
                  "env": {
                    "GOOGLE_ANALYTICS_PROPERTY_ID": "${{ secrets.GA_PROPERTY_ID }}",
                    "GOOGLE_ANALYTICS_CREDENTIALS": "${{ secrets.GA_CREDENTIALS }}"
                  }
                }
              ]
            }
          prompt: |
            ## ğŸ“Š GA4ã‚·ãƒ³ãƒ—ãƒ«åˆ†æ & æ”¹å–„ææ¡ˆ
            
            GA4ã‹ã‚‰åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€å®Ÿç”¨çš„ãªæ”¹å–„ææ¡ˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
            
            ### ğŸ“… åˆ†æè¨­å®š
            - **å¯¾è±¡æœŸé–“**: ${{ github.event.inputs.date_range || 'yesterday' }}
            - **å®Ÿè¡Œæ™‚åˆ»**: ${{ github.run_started_at }}
            
            ### ğŸ” å®Ÿè¡Œæ‰‹é †
            
            1. **åŸºæœ¬ãƒ‡ãƒ¼ã‚¿å–å¾—**
               
               ä»¥ä¸‹ã®2ã¤ã®åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã®ã¿å–å¾—ï¼š
               
               ```
               # ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿
               google-analytics:getPageViews({ 
                 startDate: "${{ github.event.inputs.date_range || 'yesterday' }}", 
                 endDate: "${{ github.event.inputs.date_range || 'yesterday' }}",
                 dimensions: ["page"]
               })
               
               # ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿
               google-analytics:getEvents({ 
                 startDate: "${{ github.event.inputs.date_range || 'yesterday' }}", 
                 endDate: "${{ github.event.inputs.date_range || 'yesterday' }}" 
               })
               ```
            
            2. **ãƒ‡ãƒ¼ã‚¿åˆ†æ & Issueä½œæˆ**
               
               å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€ä»¥ä¸‹ã®å½¢å¼ã§Issueã‚’ä½œæˆï¼š
               
               ```bash
               gh issue create \
                 --title "ğŸ“Š GA4åˆ†æ & æ”¹å–„ææ¡ˆ - $(date '+%Y-%m-%d')" \
                 --body "# ğŸ“Š GA4åˆ†æ & æ”¹å–„ææ¡ˆ
               
               ## ğŸ“… åˆ†ææ¦‚è¦
               - **å¯¾è±¡æ—¥**: ${{ github.event.inputs.date_range || 'yesterday' }}
               - **åˆ†ææ™‚åˆ»**: ${{ github.run_started_at }}
               
               ## ğŸ“ˆ åŸºæœ¬ãƒ‡ãƒ¼ã‚¿
               
               ### ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼åˆ†æ
               \`\`\`
               ç·ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼: [åˆè¨ˆæ•°]
               
               äººæ°—ãƒšãƒ¼ã‚¸ TOP3:
               1. [ãƒšãƒ¼ã‚¸å] - [PVæ•°]
               2. [ãƒšãƒ¼ã‚¸å] - [PVæ•°] 
               3. [ãƒšãƒ¼ã‚¸å] - [PVæ•°]
               \`\`\`
               
               ### ã‚¤ãƒ™ãƒ³ãƒˆåˆ†æ
               \`\`\`
               ç·ã‚¤ãƒ™ãƒ³ãƒˆæ•°: [åˆè¨ˆæ•°]
               
               ä¸»è¦ã‚¤ãƒ™ãƒ³ãƒˆ TOP3:
               1. [ã‚¤ãƒ™ãƒ³ãƒˆå] - [å›æ•°]
               2. [ã‚¤ãƒ™ãƒ³ãƒˆå] - [å›æ•°]
               3. [ã‚¤ãƒ™ãƒ³ãƒˆå] - [å›æ•°]
               \`\`\`
               
               ## ğŸ’¡ æ”¹å–„ææ¡ˆ
               
               ### ğŸ¯ ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼æ”¹å–„
               
               **ğŸ“Š ç¾çŠ¶åˆ†æ:**
               - æœ€ã‚‚äººæ°—: [1ä½ã®ãƒšãƒ¼ã‚¸] ([PVæ•°])
               - æ”¹å–„å¯¾è±¡: [ä¸‹ä½ã®ãƒšãƒ¼ã‚¸] ([PVæ•°])
               
               **ğŸ”§ å…·ä½“çš„æ”¹å–„æ¡ˆ:**
               1. **ä½PVãƒšãƒ¼ã‚¸ã®æ”¹å–„**
                  - ã‚¿ã‚¤ãƒˆãƒ«ã®è¦‹ç›´ã—ï¼ˆSEOå¯¾ç­–ï¼‰
                  - å†…éƒ¨ãƒªãƒ³ã‚¯ã®è¿½åŠ 
                  - ã‚½ãƒ¼ã‚·ãƒ£ãƒ«å…±æœ‰ã®ä¿ƒé€²
               
               2. **äººæ°—ãƒšãƒ¼ã‚¸ã®æ´»ç”¨**
                  - é–¢é€£ãƒšãƒ¼ã‚¸ã¸ã®å°ç·šå¼·åŒ–
                  - CTAï¼ˆè¡Œå‹•å–šèµ·ï¼‰ã®æœ€é©åŒ–
                  - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ‹¡å……
               
               ### ğŸª ã‚¤ãƒ™ãƒ³ãƒˆæ”¹å–„
               
               **ğŸ“Š ç¾çŠ¶åˆ†æ:**
               - æœ€å¤šã‚¤ãƒ™ãƒ³ãƒˆ: [1ä½ã®ã‚¤ãƒ™ãƒ³ãƒˆ] ([å›æ•°])
               - æ”¹å–„å¯¾è±¡: [å°‘ãªã„ã‚¤ãƒ™ãƒ³ãƒˆ] ([å›æ•°])
               
               **ğŸ”§ å…·ä½“çš„æ”¹å–„æ¡ˆ:**
               1. **ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆå‘ä¸Š**
                  - ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ç‡ã®æ”¹å–„
                  - ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ·±åº¦ã®å‘ä¸Š
                  - æ»åœ¨æ™‚é–“ã®å»¶é•·
               
               2. **ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³æœ€é©åŒ–**
                  - é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆã®å°ç·šæ”¹å–„
                  - ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Š
                  - A/Bãƒ†ã‚¹ãƒˆã®å®Ÿæ–½
               
               ## ğŸ“‹ ä»Šé€±ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³
               
               ### ğŸš€ ã™ãã§ãã‚‹æ”¹å–„ï¼ˆ1-3æ—¥ï¼‰
               - [ ] ä½PVãƒšãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒˆãƒ«è¦‹ç›´ã—
               - [ ] äººæ°—ãƒšãƒ¼ã‚¸ã«é–¢é€£ãƒªãƒ³ã‚¯è¿½åŠ 
               - [ ] é‡è¦ãƒœã‚¿ãƒ³ã®é…ç½®ç¢ºèª
               
               ### ğŸ“ˆ ä¸­æœŸæ”¹å–„ï¼ˆ1-2é€±é–“ï¼‰
               - [ ] SEOå¯¾ç­–ã®å®Ÿæ–½
               - [ ] ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¿½åŠ ãƒ»æ›´æ–°
               - [ ] ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
               
               ### ğŸ¯ åŠ¹æœæ¸¬å®šï¼ˆç¶™ç¶šï¼‰
               - [ ] æ”¹å–„å¾Œã®PVå¤‰åŒ–ã‚’ç›£è¦–
               - [ ] ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿç‡ã®è¿½è·¡
               - [ ] é€±æ¬¡ã§ã®æ”¹å–„åŠ¹æœç¢ºèª
               
               ## ğŸ¤– æ¬¡å›åˆ†æã‚³ãƒãƒ³ãƒ‰
               - \`@gemini analyze\` - ä»Šæ—¥ã®åˆ†æ
               - \`@gemini analyze 7days\` - é€±æ¬¡åˆ†æ
               - \`@gemini analyze 30days\` - æœˆæ¬¡åˆ†æ
               
               ## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã®è¦‹æ–¹
               
               ### PVæ•°ã®ç›®å®‰
               - ğŸ˜Š 50+ : äººæ°—ãƒšãƒ¼ã‚¸
               - ğŸ™‚ 10-50 : å¹³å‡çš„
               - ğŸ˜ 1-10 : æ”¹å–„è¦
               - ğŸ˜” 0 : è¦å¯¾ç­–
               
               ### ã‚¤ãƒ™ãƒ³ãƒˆæ•°ã®ç›®å®‰  
               - ğŸ‰ 100+ : é«˜ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ
               - ğŸ‘ 20-100 : è‰¯å¥½
               - ğŸ¤” 5-20 : æ”¹å–„ä½™åœ°ã‚ã‚Š
               - ğŸ˜Ÿ 0-5 : è¦æ”¹å–„
               
               ---
               
               **ğŸ”„ æ¬¡å›æ”¹å–„ãƒã‚§ãƒƒã‚¯**: [1é€±é–“å¾Œã®æ—¥ä»˜]  
               **ğŸ“ˆ æ”¹å–„ç›®æ¨™**: PV +20%, ã‚¤ãƒ™ãƒ³ãƒˆ +15%"
               ```
            
            ### âš¡ é‡è¦ãªå®Ÿè¡ŒæŒ‡ç¤º
            
            1. **ã‚·ãƒ³ãƒ—ãƒ«ã•é‡è¦–**
               - ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã¨ã‚¤ãƒ™ãƒ³ãƒˆæ•°ã®ã¿ã«é›†ä¸­
               - è¤‡é›‘ãªåˆ†æã¯é¿ã‘ã‚‹
               - æ•°å€¤ã¯åˆ†ã‹ã‚Šã‚„ã™ãè¡¨ç¤º
            
            2. **å®Ÿç”¨çš„ãªæ”¹å–„ææ¡ˆ**
               - å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³é …ç›®ã‚’æç¤º
               - å„ªå…ˆåº¦ã‚’æ˜ç¢ºã«ã™ã‚‹
               - å®Ÿæ–½å¯èƒ½ãªç¯„å›²ã§ææ¡ˆ
            
            3. **ãƒ‡ãƒ¼ã‚¿ã®è§£é‡ˆ**
               - æ•°å€¤ã ã‘ã§ãªãã€ãã®æ„å‘³ã‚’èª¬æ˜
               - æ¥­ç•Œå¹³å‡ã¨ã®æ¯”è¼ƒï¼ˆå¯èƒ½ã§ã‚ã‚Œã°ï¼‰
               - æ”¹å–„ã®æ–¹å‘æ€§ã‚’ç¤ºã™
            
            4. **ç¶™ç¶šæ€§ã®æ‹…ä¿**
               - æ¬¡å›ãƒã‚§ãƒƒã‚¯æ—¥ã‚’è¨­å®š
               - æ”¹å–„ç›®æ¨™ã®æ•°å€¤åŒ–
               - é€²æ—è¿½è·¡ã®ä»•çµ„ã¿
            
            5. **ã‚¨ãƒ©ãƒ¼æ™‚ã®å¯¾å¿œ**
               - ãƒ‡ãƒ¼ã‚¿å–å¾—ã§ããªã„å ´åˆã¯ä»£æ›¿æ¡ˆæç¤º
               - éƒ¨åˆ†çš„ãªãƒ‡ãƒ¼ã‚¿ã§ã‚‚åˆ†æå®Ÿè¡Œ
               - æ”¹å–„ã§ããªã„ç†ç”±ã‚‚èª¬æ˜
            
            ä»Šã™ãGA4 MCPã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€å®Ÿç”¨çš„ãªæ”¹å–„ææ¡ˆã‚’å«ã‚€Issueã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼

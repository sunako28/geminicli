# .github/workflows/gemini-comment-handler.yml
name: Gemini Comment Handler

on:
  workflow_dispatch:    # â†ã“ã‚ŒãŒã€ŒRun workflowã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã•ã›ã‚‹
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]

jobs:
  handle-gemini-comment:
    # æ‰‹å‹•å®Ÿè¡Œæ™‚ã¯å¸¸ã«å®Ÿè¡Œã€ã‚³ãƒ¡ãƒ³ãƒˆæ™‚ã¯@geminiã§å§‹ã¾ã‚‹å ´åˆã®ã¿å®Ÿè¡Œ
    if: github.event_name == 'workflow_dispatch' || startsWith(github.event.comment.body, '@gemini')
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      pull-requests: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Test Gemini Comment Handler
        uses: google-gemini/gemini-cli-action@main
        env:
          GH_TOKEN: ${{ github.token }}
        with:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          prompt: |
            ## Geminiã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
            
            å®Ÿè¡Œæƒ…å ±:
            - å®Ÿè¡Œæ–¹æ³•: ${{ github.event_name }}
            - å®Ÿè¡Œæ™‚åˆ»: ${{ github.run_started_at }}
            - ãƒªãƒã‚¸ãƒˆãƒª: ${{ github.repository }}
            
            ä»¥ä¸‹ã®å†…å®¹ã§ãƒ†ã‚¹ãƒˆçµæœã‚’GitHub Issueã¨ã—ã¦ä½œæˆã—ã¦ãã ã•ã„:
            
            **ã‚¿ã‚¤ãƒˆãƒ«**: ğŸ¤– Geminiã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½å‹•ä½œãƒ†ã‚¹ãƒˆçµæœ
            
            **å†…å®¹**:
            ### âœ… åŸºæœ¬å‹•ä½œç¢ºèª
            - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ: æˆåŠŸ
            - GitHub Actionsé€£æº: æ­£å¸¸
            - Issueä½œæˆæ©Ÿèƒ½: æ­£å¸¸
            
            ### ğŸ“ æ¬¡ã®ãƒ†ã‚¹ãƒˆæ‰‹é †
            1. ã“ã®Issueã«ä»¥ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿:
               ```
               @gemini ã“ã‚“ã«ã¡ã¯ï¼ã‚³ãƒ¡ãƒ³ãƒˆåå¿œãƒ†ã‚¹ãƒˆã§ã™ã€‚
               ```
            2. æ•°åˆ†å¾…ã£ã¦ã€Geminiã‹ã‚‰ã®è¿”ä¿¡ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèª
            3. è¿”ä¿¡ãŒã‚ã‚Œã°ã€ã‚³ãƒ¡ãƒ³ãƒˆåå¿œæ©Ÿèƒ½ãŒæ­£å¸¸å‹•ä½œ
            
            ### ğŸ”§ ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ¡ãƒ³ãƒˆä¾‹
            - `@gemini ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¦‚è¦ã‚’æ•™ãˆã¦`
            - `@gemini ã‚³ãƒ¼ãƒ‰æ”¹å–„ææ¡ˆã‚’ã—ã¦`
            - `@gemini GEMINI.mdã®å†…å®¹ã‚’è¦ç´„ã—ã¦`
            
            ### ğŸ“Š å®Ÿè¡Œè©³ç´°
            - å®Ÿè¡ŒID: ${{ github.run_id }}
            - å®Ÿè¡Œç•ªå·: ${{ github.run_number }}
            
            ã“ã®Issueã‚’ä»Šã™ãä½œæˆã—ã¦ãã ã•ã„ã€‚
